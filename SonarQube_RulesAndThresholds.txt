1ï¸âƒ£ The 3 Ways to â€œAdd Rulesâ€ in SonarQube
Level	Can we do it?	Typical Use Case
Enable existing rules	âœ… Yes	Most common
Create custom rules via plugins	âœ… Yes	Enterprise / advanced
Import rules from external tools	âœ… Yes	Checkstyle, PMD, SpotBugs

âš ï¸ You cannot write new rules directly from the Sonar UI (except templates).

2ï¸âƒ£ Option 1 â€“ Enable / Disable Existing Rules (Most Common)

SonarQube ships with thousands of built-in rules.

How:

SonarQube â†’ Quality Profiles
Select language (Java)
Activate / deactivate rules
Assign profile to project

âœ” No coding
âœ” Fast
âœ” 90% of real projects use this

Example (Automation Framework)

Enable rules like:
âŒ Thread.sleep() usage
âŒ Empty catch blocks
âŒ Hard-coded waits
âŒ Static WebDriver usage

3ï¸âƒ£ Option 2 â€“ Create Custom Rules (Advanced / Enterprise)

Used when:
Company has internal coding standards
Automation-specific violations
Architecture rules

Two supported approaches:
ğŸ”¹ A) Custom Java Rule (Plugin)

You write a SonarQube plugin.
Steps (High-level):

Create a Maven project
Use Sonar Java Plugin APIs
Write AST-based rule
Package as JAR
Drop into extensions/plugins
Restart SonarQube

Example Custom Rule

â€œFail if Selenium test uses Thread.sleep() instead of WaitStrategyâ€

		@Rule(
		  key = "NoThreadSleep",
		  name = "Thread.sleep should not be used",
		  priority = Priority.CRITICAL
		)
		public class NoThreadSleepRule extends IssuableSubscriptionVisitor {

			@Override
			public List<Tree.Kind> nodesToVisit() {
				return Collections.singletonList(Tree.Kind.METHOD_INVOCATION);
			}

			@Override
			public void visitNode(Tree tree) {
				MethodInvocationTree mit = (MethodInvocationTree) tree;
				if (mit.symbol().name().equals("sleep")) {
					reportIssue(mit, "Use Selenium Wait Strategy instead of Thread.sleep");
				}
			}
		}


			âœ” Enterprise-grade
			âŒ Requires Java AST knowledge
			âŒ Maintenance-heavy

ğŸ”¹ B) Rule Templates (Limited Customization)

Sonar allows rule templates, where you:

Clone an existing rule
Change thresholds / regex
Change severity

Example:

Maximum allowed method length
Cyclomatic complexity threshold
Regex-based naming rules

		âœ” Easy
		âŒ Limited flexibility

4ï¸âƒ£ Option 3 â€“ Import Rules from External Tools

SonarQube integrates with:

Tool					Purpose
Checkstyle				Coding standards
PMD						Code quality
SpotBugs				Runtime bug detection
Example:

Custom Checkstyle XML for automation standards

Enforce page object naming
Restrict static variables
Sonar imports violations as issues.

5ï¸âƒ£ Automation Frameworkâ€“Specific Rules (Real World)

In Selenium / Cucumber frameworks, teams often add rules like:

Rule												Reason
No Thread.sleep										Flaky tests
No static WebDriver									Parallel issues
Page classes must not contain assertions			SRP
Step definitions must not use WebDriver directly	Architecture
No hard-coded test data								Maintainability


6ï¸âƒ£ What You CANNOT Do

âŒ Write rules directly in UI (except templates)
âŒ Detect runtime flakiness
âŒ Detect whether a test caught a bug
âŒ Add business logic rules

Sonar = static analysis only

7ï¸âƒ£ Interview-Ready Answer (Senior Level)

â€œYes, SonarQube supports adding rules in multiple ways. Most teams customize Quality Profiles by enabling or disabling built-in rules. For advanced needs, custom rules can be implemented via Sonar plugins using the Java analyzer API, or by integrating external tools like Checkstyle or PMD. Rule templates allow limited customization without coding. However, SonarQube only supports static analysis and cannot detect runtime behavior.â€

8ï¸âƒ£ One-Liner for Interviews

â€œYou donâ€™t usually add new rules â€” you activate, tune, or extend existing ones.â€




----------------------------------------------------------------------------------------------------------------------------------

When NOT to Write Custom SonarQube Rules
ğŸ”´ Rule #1: If an Existing Rule Already Covers It
âŒ Donâ€™t write a custom rule when:

Sonar already has a built-in rule
Or the issue can be caught via:
Quality Profile tuning
Rule severity changes
Threshold adjustment

Example (Automation)

âŒ Writing a rule for:

Long methods
High cyclomatic complexity
Duplicate code
Unused variables

âœ” These already exist

Interview line:
â€œCustom rules are unnecessary if built-in rules can be configured to enforce the same behavior.â€

ğŸ”´ Rule #2: If the Issue Is Runtime / Behavioral

SonarQube performs static analysis only.

âŒ Donâ€™t write rules for:

Flaky tests
Timing issues
API instability
Selenium synchronization problems
Network failures
Environment-dependent failures

Example

âŒ â€œDetect flaky Selenium testsâ€
âŒ â€œCheck if explicit wait is long enoughâ€

âœ” These require execution data, not source code

Interview line:
â€œStatic analysis cannot reason about runtime behavior.â€

ğŸ”´ Rule #3: If the Rule Is Project-Specific
âŒ Donâ€™t write custom rules when:

Only one project needs it

Temporary workaround

Team preference, not organization standard

Example

âŒ â€œAll tests must use XYZ namingâ€ (only for one repo)
âŒ â€œUse Chrome onlyâ€ (environment constraint)

âœ” Use code reviews or linters instead

Interview line:
â€œCustom rules should represent organization-wide standards, not local conventions.â€

ğŸ”´ Rule #4: If Maintenance Cost > Benefit

Custom rules:

Break with Sonar upgrades
Need AST expertise
Require plugin maintenance

Need documentation + training

âŒ Donâ€™t write rules when:

Rule logic is complex
Analyzer version changes often
Team lacks Sonar plugin expertise

Example

âŒ Custom rule checking Page Object + Step Definition interaction

âœ” Better solved via:

Architecture tests
Code reviews
Framework design

Interview line:
â€œIf the rule costs more to maintain than the defects it prevents, itâ€™s not worth it.â€

ğŸ”´ Rule #5: If the Problem Is Architectural

Sonar rules work per file, not system-wide architecture.

âŒ Donâ€™t write rules for:

Layer violations
Incorrect framework usage
Wrong dependency direction

Example

âŒ â€œStep Definitions must not use WebDriverâ€
âŒ â€œPage Objects must not call APIsâ€

âœ” Use:

ArchUnit

Design reviews

Framework enforcement

ğŸ”´ Rule #6: If Rule Depends on Business Logic
âŒ Donâ€™t write rules when:

Logic depends on domain knowledge
Business flows
Test data semantics

Example

âŒ â€œRegistration test must validate OTPâ€
âŒ â€œAPI response must contain correct discount logicâ€

âœ” These belong in tests, not static analysis

âœ… When You SHOULD Write Custom Rules (Contrast)
Write Rule When	Reason
Organization-wide standard	Consistency
Repeated violations	High ROI
Simple AST logic	Low maintenance
Security/compliance	Mandatory
Automation anti-patterns	Framework health
Example (Good Custom Rule)

âœ” No Thread.sleep()
âœ” No static WebDriver
âœ” No assertions in Page Objects
âœ” No hard-coded credentials

ğŸ¯ Interview-Ready Summary (Perfect Answer)

â€œCustom SonarQube rules should only be written when existing rules cannot enforce an organization-wide standard and the benefit outweighs the long-term maintenance cost. They should not be used for runtime behavior, project-specific conventions, business logic, or architectural enforcement. In most cases, tuning existing rules or using complementary tools like Checkstyle or ArchUnit is the better approach.â€