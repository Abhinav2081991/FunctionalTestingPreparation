1. Having Text based locators  adds risk to headless execution . FOr ex - 


 public WebElement getSubmitButton() {
        WebElement element =  driver.findElements(By.xpath("//button")).stream()
                .filter(WebElement ::isDisplayed)
                .filter(btn -> btn.getText().trim().equals("Submit"))
                .findFirst()
                .orElseThrow(() -> new NoSuchElementException("Submit button not found"));

        ((JavascriptExecutor)driver).executeScript("arguments[0].scrollIntoView(true);", element);
		
		
		The above is useless code. Instead try for id , cssSelector, 
		
		By submitBtn = By.xpath("//button[@type='submit']");

or

By submitBtn = By.cssSelector("button[id='submitbtn']");

Then:

public WebElement getSubmitButton() {
    return waitResolver.waitForElementToBeClickable(
            By.cssSelector("button[type='submit']")
    );
}

Headless often fails on normal .click().

public void clickSubmit() {
    WebElement btn = getSubmitButton();
    ((JavascriptExecutor) driver).executeScript(
        "arguments[0].click();", btn
    );
}


ğŸ Bottom Line

âœ” Your hooks are correct
âœ” Your driver lifecycle is correct
âŒ Your element resolution strategy is not headless-safe

Once you:

remove getText() dependency
add explicit waits
prefer stable locators

ğŸ‘‰ Headless will behave exactly like headed mode


---------------------------------------------------------------------------------------

Common Selenium Patterns That Fail in CI/CD (But Work Locally)
1ï¸âƒ£ Missing Explicit Waits (Timing Dependency)
âŒ Works Locally
driver.findElement(By.id("submit")).click();

ğŸ’¥ Fails in CI

Slower CPU

No GPU

Headless rendering delay

âœ… Fix
WebElement submit = new WebDriverWait(driver, Duration.ofSeconds(10))
        .until(ExpectedConditions.elementToBeClickable(By.id("submit")));
submit.click();


ğŸ“Œ CI is slower, not broken

2ï¸âƒ£ Hardcoded Thread.sleep()
âŒ Works Locally
Thread.sleep(2000);
driver.findElement(By.id("save")).click();

ğŸ’¥ Fails in CI

Animation takes longer

Network latency

Unpredictable load

âœ… Fix
wait.until(ExpectedConditions.invisibilityOfElementLocated(By.id("loader")));
driver.findElement(By.id("save")).click();

3ï¸âƒ£ Headless Viewport Issues
âŒ Works Locally
driver.findElement(By.id("login")).click();

ğŸ’¥ Fails in CI (Headless)

Element is off-screen

Not interactable

âœ… Fix
options.addArguments("--window-size=1920,1080");

((JavascriptExecutor) driver)
        .executeScript("arguments[0].scrollIntoView(true);", element);
element.click();

4ï¸âƒ£ ElementClickInterceptedException (Overlays)
âŒ Works Locally
driver.findElement(By.xpath("//button[text()='Submit']")).click();

ğŸ’¥ Fails in CI

Cookie banner

Loader overlay

A/B testing banners

âœ… Fix
wait.until(ExpectedConditions.elementToBeClickable(button)).click();


Or JS fallback (last resort).

5ï¸âƒ£ Absolute XPaths (Fragile Locators)
âŒ Works Locally
By.xpath("/html/body/div[2]/div[3]/button[1]");

ğŸ’¥ Fails in CI

DOM rendered slightly differently

Responsive layout

âœ… Fix
By.xpath("//button[normalize-space()='Submit']");

6ï¸âƒ£ File Upload Using Relative Paths
âŒ Works Locally
fileInput.sendKeys("src/test/resources/file.pdf");

ğŸ’¥ Fails in CI

Different workspace path

âœ… Fix
Path filePath = Paths.get("src/test/resources/file.pdf").toAbsolutePath();
fileInput.sendKeys(filePath.toString());

7ï¸âƒ£ Assumption That Tests Run Sequentially
âŒ Works Locally
static WebDriver driver;

ğŸ’¥ Fails in CI

Parallel execution

Thread collision

âœ… Fix
private static ThreadLocal<WebDriver> driver = new ThreadLocal<>();

8ï¸âƒ£ Using Browser Cache / Cookies
âŒ Works Locally
driver.get("https://app.example.com/dashboard");

ğŸ’¥ Fails in CI

Clean environment

No cached login

âœ… Fix
loginPage.login(user, password);


ğŸ“Œ CI = fresh machine every time

9ï¸âƒ£ Hover-Based Actions
âŒ Works Locally
actions.moveToElement(menu).perform();
submenu.click();

ğŸ’¥ Fails in CI

Headless doesnâ€™t hover well

âœ… Fix
wait.until(ExpectedConditions.visibilityOf(submenu)).click();


or JS-trigger hover.

ğŸ”Ÿ JavaScript Execution Timing
âŒ Works Locally
((JavascriptExecutor) driver)
    .executeScript("document.querySelector('#btn').click()");

ğŸ’¥ Fails in CI

DOM not fully loaded

âœ… Fix
wait.until(webDriver ->
    ((JavascriptExecutor) webDriver)
        .executeScript("return document.readyState").equals("complete"));

1ï¸âƒ£1ï¸âƒ£ Font / CSS Differences
âŒ Works Locally
assertEquals("Submit", button.getText());

ğŸ’¥ Fails in CI

Different fonts / trimming

Upper/lower case rendering

âœ… Fix
assertTrue(button.getText().trim().equalsIgnoreCase("Submit"));

1ï¸âƒ£2ï¸âƒ£ Dependency on Screen Resolution
âŒ Works Locally
assertTrue(element.isDisplayed());

ğŸ’¥ Fails in CI

Responsive UI hides element

âœ… Fix
options.addArguments("--window-size=1920,1080");

ğŸ§  Golden Rule for CI/CD Selenium

If it works locally but fails in CI, your test is timing-dependent, not the environment.

âœ… CI-Safe Selenium Checklist (Print This)

âœ” Explicit waits everywhere
âœ” No Thread.sleep
âœ” Stable locators
âœ” Headless viewport set
âœ” No shared static state
âœ” Retry + JS fallback only as last resort
âœ” Screenshots + logs on failure



----------------------------------------------------------------------------------------------------


Selenium CI Failure Debugging Playbook

(Local Pass âŒ | CI Fail ğŸ’¥)

ğŸ”´ STEP 0: Classify the Failure (Donâ€™t Guess)

First question you must answer:

Symptom	Category
Element not found / not clickable	Timing / UI sync
Works locally only	Headless / resolution
Random failures	Flakiness / async
Only in parallel	Thread safety
Passes on rerun	Retry masking
Screenshot shows wrong page	Navigation / auth

ğŸ“Œ Never debug blindly â€” classify first.

ğŸ” STEP 1: Always Capture Evidence
âœ… Mandatory on Every CI Failure
@AfterStep
public void afterStep(Scenario scenario) {
    if (scenario.isFailed()) {
        takeScreenshot();
        savePageSource();
        logBrowserConsole();
    }
}

ğŸ“¸ Screenshot
byte[] screenshot = ((TakesScreenshot) driver)
        .getScreenshotAs(OutputType.BYTES);
scenario.attach(screenshot, "image/png", "Failure Screenshot");

ğŸ“„ Page Source
Files.write(
    Paths.get("target/pagesource.html"),
    driver.getPageSource().getBytes()
);

ğŸŸ  STEP 2: Reproduce CI Locally (Critical)
ğŸ” Run exact CI config locally
mvn clean test \
-Dheadless=true \
-Dbrowser=CHROME \
-Dexecution=LOCAL


Same:

Java version

Chrome version

Maven profile

Headless flags

ğŸ“Œ If you canâ€™t reproduce locally, youâ€™re blind.

ğŸŸ¡ STEP 3: Headless-Specific Fixes
âŒ Common CI Breaker
driver.findElement(By.id("submit")).click();

âœ… CI-Safe Pattern
options.addArguments("--window-size=1920,1080");
wait.until(ExpectedConditions.elementToBeClickable(submit)).click();

ğŸ§  Debug Trick

Run headed in CI once:

--headless=false


If it passes â†’ viewport issue confirmed

ğŸ”µ STEP 4: Validate Timing & Async Issues
âŒ Smells Bad
Thread.sleep(2000);

âœ… Smells Good
wait.until(ExpectedConditions.invisibilityOf(loader));
wait.until(ExpectedConditions.elementToBeClickable(button));

ğŸŸ£ STEP 5: Detect Overlay / Interception
Symptom
ElementClickInterceptedException

ğŸ” Debug Overlay
((JavascriptExecutor) driver)
    .executeScript("document.body.style.border='5px solid red'");

âœ… Fix
wait.until(ExpectedConditions.elementToBeClickable(element));


JS click only as last resort.

ğŸŸ¤ STEP 6: Parallel Execution Bugs
âŒ Local Single Thread
static WebDriver driver;

ğŸ’¥ CI Parallel Failure

Null driver

Wrong browser

Random failures

âœ… Fix
private static ThreadLocal<WebDriver> driver = new ThreadLocal<>();


ğŸ“Œ If failure disappears when parallelism = 1 â†’ thread safety bug

âš« STEP 7: Environment Validation

Add this at test start:

System.out.println("Java: " + System.getProperty("java.version"));
System.out.println("OS: " + System.getProperty("os.name"));
System.out.println("Browser: " + capabilities.getBrowserVersion());


CI failures often hide version mismatch issues.

ğŸ”¥ STEP 8: DOM Reality Check
âŒ Assumption
assertEquals("Submit", button.getText());

ğŸ’¥ CI Reality

Extra spaces

Uppercase

Localization

âœ… Fix
assertTrue(button.getText().trim().equalsIgnoreCase("submit"));

ğŸ§¯ STEP 9: Retry (But Be Honest)
âŒ Bad
retry(5); // hides bugs

âœ… Good
retry(2); // logs + screenshots + metrics


ğŸ“Œ Retries without root cause = technical debt

ğŸ§  STEP 10: CI-Only Debug Hooks (Hidden Gold)
Log browser console
driver.manage().logs().get(LogType.BROWSER)
      .forEach(log -> System.out.println(log.getMessage()));

Dump active overlays
executeScript(
 "return document.querySelectorAll('div[style*=\"position: fixed\"]').length");

ğŸ§ª CI Debug Decision Tree
Fails only in CI?
  â”œâ”€â”€ Yes â†’ Headless / Timing / Resolution
  â”œâ”€â”€ Random â†’ Async / Parallel / Overlay
  â”œâ”€â”€ Only on first run â†’ Auth / Cache
  â””â”€â”€ Only in parallel â†’ ThreadLocal issue

ğŸ† Signs Youâ€™ve Fixed It Properly

âœ” Passes 10+ CI runs
âœ” Passes with parallel = 5
âœ” Passes headless + headed
âœ” No retries needed
âœ” Failure screenshots are clean

ğŸ’¬ Architect-Level Quote (Use This ğŸ˜)

CI doesnâ€™t make Selenium flaky.
It exposes the flakiness you already had.